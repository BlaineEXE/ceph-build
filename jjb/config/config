#!/usr/bin/env bash

#
# This script uses Jenkins Job Builder to generate the configuration for its own
# job so that it automatically configures all other jobs that have their YAML
# definitions.
#

# Install Jenkins-jobs
virtualenv venv
. venv/bin/activate
venv/bin/pip install jenkins-job-builder
venv/bin/tox -rv -e docs

# Create the definitions testing them first
venv/bin/jenkins-jobs test jjb/config/definitions -o output

# Update Jenkins with the output
# Note that this needs proper permissions with the right credentials to the
# correct Jenkins instance
venv/bin/jenkins-jobs update jjb/config/definitions
