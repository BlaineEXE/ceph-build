#!/usr/bin/env python
from subprocess import Popen, PIPE
import os

target_branch = os.getenv('ghprbTargetBranch', 'master')
source_branch = os.getenv('ghprbSourceBranch', 'HEAD')

command = ['git', 'log', '%s..%s' % (target_branch, source_branch)]


process = Popen(
    command,
    stdout=PIPE,
    stderr=PIPE,
    close_fds=True
)

returncode = process.wait()

stdout = process.stdout.read()
stderr = process.stderr.read()

# git log output goes to stdout so process that

for chunk in stdout.split('commit '): # we are interested in every commit chunk
    if not 'Signed-off-by:' in chunk:
        raise SystemExit('A commit is missing "Signed-off-by"')
