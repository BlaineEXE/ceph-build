#!/bin/bash

# the following two methods exist in scripts/build_utils.sh
pkgs=( "ansible" )
install_python_packages "pkgs[@]"

# ceph-ansible does a check on the installed version of ansible and
# without our virtualenv activated it can not find it and fails
source $VENV/activate

cat > $HOME/test-vars.json << EOF
{
    "devices":["/dev/vdb"],
    "ceph_stable":true,
    "journal_collocation":true,
    "journal_size":1024,
    "monitor_interface":"eth1",
    "cluster_network":"127.0.0.1/0",
    "public_network":"127.0.0.1/0",
    "os_tuning_params":[
        {"name": "kernel.pid_max", "value": 4194303},
        {"name": "fs.file-max", "value": 26234859}
    ]
}
EOF

cd "$WORKSPACE"/ceph-ansible
$VENV/ansible-playbook -vv -i tests/inventories/single-machine.yml -c local test.yml --extra-vars "@$HOME/test-vars.json"
