# This playbook requires that you install the roles defined
# in ./sensu-requiremnts.yml. Do this by running:
#
#     ansible-galaxy install -r sensu-requirements.yml
#
- hosts: all
  sudo: true
  vars_files:
    - sensu-vars.yml
  roles:
    - role: Mayeu.RabbitMQ
      rabbitmq_vhost_definitions:
          - name: "/sensu"
      rabbitmq_users_definitions:
          - vhost: "/sensu"
            user: sensu
            password: secret
            configure_priv: ".*"
            read_priv: ".*"
            write_priv: ".*"
      rabbitmq_ssl: false
    - redis
    - role: Mayeu.sensu
      sensu_server_rabbitmq_port: 5672
      sensu_server_api_password: secret
      sensu_server_rabbitmq_password: secret
      sensu_server_dashboard_password: secret
      sensu_client_subscription_names:
        - common
        - rabbitmq
      # these are custom settings for this client
      sensu_settings:
        # used in the rabbitmq-alive check
        rabbitmq:
          user: sensu
          password: secret
          # we need to escape the / in /sensu
          vhost: "%2Fsensu"
